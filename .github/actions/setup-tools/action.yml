name: 'Setup Development Tools'
description: 'Install Task, mise, and project tools with caching'
runs:
  using: 'composite'
  steps:
    - name: Setup Task
      uses: go-task/setup-task@v1

    - name: Install Mise (Darwin & Linux)
      if: ${{ runner.os != 'Windows' }}
      shell: bash
      run: curl https://mise.run | sh

    - name: Install Mise (Windows)
      if: ${{ runner.os == 'Windows' }}
      shell: pwsh
      run: winget install --id=jdx.mise -e --force --accept-source-agreements

    - uses: actions/cache@v4
      with:
        key: ${{ runner.os }}-${{ runner.arch }}-mise-tools-${{ hashFiles('.mise.toml') }}
        path: |
          ~/.local/share/mise
          ~/.cache/mise
          ~/.venv

    - name: Install mise tools
      shell: bash
      env:
        GITHUB_TOKEN: ${{ github.token }}
      run: |
        mise install --yes
        mise run uv:sync
