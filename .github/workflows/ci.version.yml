name: CI Â» Version

on:
  workflow_call:
    inputs:
      pr_auto_merge:
        description: "Auto-merge the version bump PR"
        required: false
        type: boolean
        default: false
    secrets:
      GH_TOKEN:
        description: "GitHub token for version bump and PR creation"
        required: true
    outputs:
      version_tag:
        description: "The version tag that was created (e.g., v1.2.3)"
        value: ${{ jobs.version.outputs.version_tag }}

jobs:
  version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    outputs:
      version_tag: ${{ steps.bump.outputs.tag }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GH_TOKEN }}

      - name: Bump version with Bumpalicious
        id: bump
        uses: dragoscops/bumpalicious@v3
        with:
          github_token: ${{ secrets.GH_TOKEN }}
          pr: "true"
          pr_auto_merge: ${{ inputs.pr_auto_merge }}
          pr_message: "chore: version bump"
          workspaces: ".:text"

      - name: Output new version
        run: |
          echo "New version tag: ${{ steps.bump.outputs.tag }}"
