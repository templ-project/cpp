[settings]
# TODO: need experimental mode to support lock file -> can be solved using mise.local.toml
# TRICKY:
# This one breaks tools.http:llvm/llvm-project installation due to mise bug probably
# experimental = true
# This one I needs to be tested; but I haven't seen it working last time
lockfile = true
# TRICKYend

############################################################################
# Tools Configuration                                                      #
############################################################################

[tools]

# ==========================================================================
# Compilers
# ==========================================================================

# TODO: Github Backend still has issues with asset_pattern matching for LLVM releases -> mise bug
# https://github.com/llvm/llvm-project/releases
#
[tools."http:llvm/llvm-project"]
version = "20.1.8"

[tools."http:llvm/llvm-project".platforms]
linux-x64 = { url = "https://github.com/llvm/llvm-project/releases/download/llvmorg-{version}/LLVM-{version}-Linux-X64.tar.xz" }
macos-arm64 = { url = "https://github.com/llvm/llvm-project/releases/download/llvmorg-{version}/LLVM-{version}-macOS-ARM64.tar.xz" }
windows-x64 = { url = "https://github.com/llvm/llvm-project/releases/download/llvmorg-{version}/clang+llvm-{version}-x86_64-pc-windows-msvc.tar.xz" }

# ==========================================================================
# Build Tools
# ==========================================================================

# https://github.com/bazelbuild/bazel
#
[tools."github:bazelbuild/bazel"]
version = "8"
bin = "bazel"

[tools."github:bazelbuild/bazel".platforms]
linux-x64 = { asset_pattern = "bazel-*-linux-x86_64" }
macos-arm64 = { asset_pattern = "bazel-*-darwin-arm64" }
windows-x64 = { asset_pattern = "bazel-*-windows-x86_64.exe", bin = "bazel.exe" }

# https://github.com/Kitware/CMake/releases
#
[tools."github:Kitware/CMake"]
version = "latest"

# TODO: Need a Linux distro to test this
[tools."github:Kitware/CMake".platforms]
linux-x64 = { asset_pattern = "cmake-*-linux-x86_64.tar.gz" }
macos-arm64 = { asset_pattern = "cmake-*-macos-universal.tar.gz", bin_path = "CMake.app/Contents/bin" }
windows-x64 = { asset_pattern = "cmake-*-windows-x86_64.zip" }

# https://github.com/xmake-io/xmake/releases
#
[tools."github:xmake-io/xmake"]
# TODO: Latest (3.0.4) has issues with some lua modules -> pin to 3.0.3 for now
version = "3.0.3"
bin = "xmake"

# TODO: Need a Linux distro to test this
[tools."github:xmake-io/xmake".platforms]
linux-x64 = { asset_pattern = "xmake-bundle-v*.linux.x86_64" }
macos-arm64 = { asset_pattern = "xmake-bundle-v*.macos.arm64" }
windows-x64 = { asset_pattern = "xmake-bundle-v*.win64.exe", bin = "xmake.exe" }

# ==========================================================================
# Other Tools
# ==========================================================================

# https://github.com/koalaman/shellcheck/releases
# e.g. https://github.com/koalaman/shellcheck/releases/download/v0.11.0/shellcheck-v0.11.0.darwin.x86_64.tar.xz
#
[tools."github:koalaman/shellcheck"]
version = "0.11.0"

[tools."github:koalaman/shellcheck".platforms]
linux-x64 = { asset_pattern = "shellcheck-*.linux.x86_64.tar.xz" }
macos-arm64 = { asset_pattern = "shellcheck-*.darwin.aarch64.tar.xz" }
windows-x64 = { asset_pattern = "shellcheck-*.zip" }

# https://github.com/PowerShell/PowerShell/releases
# e.g. https://github.com/PowerShell/PowerShell/releases/download/v7.5.4/powershell-7.5.4-osx-arm64.tar.gz
#
[tools."github:PowerShell/PowerShell"]
version = "latest"

[tools."github:PowerShell/PowerShell".platforms]
linux-x64 = { asset_pattern = "powershell-*-linux-x64.tar.gz" }
macos-arm64 = { asset_pattern = "powershell-*-osx-arm64.tar.gz" }
windows-x64 = { asset_pattern = "PowerShell-*-win-x64.zip" }

# Node.js for jscpd & eslint
#
[tools.node]
version = "latest"

# Python and package manager
#
[tools.python]
version = "3.11" # Will install 3.11 or above based on availability
[tools.uv]
version = "latest"

# TODO: Need to install manually; so far no registry nor backends support
# # Debugger
# [tools.gdb]
# version = "latest"

# TODO: Need to install manually; so far no registry nor backends support
# Memory profiler (Linux/macOS only)
# [tools.valgrind]
# version = "latest"

############################################################################
# Hooks                                                    #
############################################################################

[hooks]
postinstall = "{% if os() != 'windows' %}chmod -R 755 $(mise bin-paths github:PowerShell/PowerShell)/pwsh; echo 'chown -R 755 pwsh'{% endif %}"
